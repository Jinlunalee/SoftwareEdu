<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.mycompany.webapp.dao.IEnrollRepository">

	<select id="getEnrollList" resultType="EnrollVO">
		SELECT  enroll_id AS "enrollId", 
				e.subject_id AS "subjectId", 
				e.subject_seq AS "subjectSeq", 
				e.student_id AS "studentId", 
				name AS "name", 
        		s.subject_title AS "subjectTitle", 
				e.state_cd AS "stateCd", 
				complete_hours AS "completeHours", 
				e.reg_id AS "regId", 
				e.reg_dt AS "regDt", 
				e.modi_id AS "modiId", 
				e.modi_dt AS "modiDt", 
				e.del_yn AS "delYn", 
				cancel_rs_etc AS "cancelRsEtc", 
        		start_time AS "startTime", 
        		end_time AS "endTime", 
        		start_day AS "startDay", 
        		end_day AS "endDay" 
		FROM ENROLL e 
		LEFT OUTER JOIN STUDENT t 
		ON e.student_id = t.student_id 
        LEFT OUTER JOIN OPEN o 
        ON e.subject_id = o.subject_id 
        LEFT OUTER JOIN SUBJECT s 
        ON e.subject_id = s.subject_id
	</select>
	
	<select id="getEnrollListBySubject" resultType="EnrollVO">
		SELECT  e.subject_id AS "subjectId", 
				e.subject_seq AS "subjectSeq", 
        		s.subject_title AS "subjectTitle" 
		FROM ENROLL e 
		LEFT OUTER JOIN SUBJECT s 
		ON e.subject_id = s.subject_id
	</select>
	
	<select id="getSubjectDetails" parameterType = "String" resultType="SubjectVO">
		SELECT e.subject_id AS "subjectId", 
		e.subject_seq AS "subjectSeq",
        s.subject_title AS "subjectTitle"
FROM ENROLL e 
LEFT OUTER JOIN SUBJECT s 
ON e.subject_id = s.subject_id
	</select>
	
	<select id="getName" parameterType="String" resultType="StudentVO">
		SELECT name AS "name" 
		FROM STUDENT 
		WHERE student_id = #{studentId}
	</select>
	
	<select id="getSubjectName" parameterType="String" resultType="SubjectVO">
		SELECT subject_title AS "subjectTitle"
		FROM SUBJECT
		WHERE subject_id = #{subjectId}
	</select>
	
	<select id="getOpenDetails" resultType="EnrollVO">
		SELECT start_time AS "startTime", 
				end_time AS "endTime", 
				start_day AS "startDay", 
				end_day AS "endDay"
		FROM OPEN o, ENROLL e
		WHERE o.subject_id = e.subject_id AND o.subject_seq = e.subject_seq
	</select>
	
	<select id="getProgress" parameterType="String" resultType="int">
		SELECT e.complete_hours/s.hours * 100
		FROM ENROLL e, SUBJECT s
		WHERE e.subject_id = s.subject_id AND e.student_id = #{studentId}
	</select>

	<update id="clickCancel" parameterType="map">
		UPDATE ENROLL 
		SET state_cd = 'ERL05' 
		WHERE student_id = #{studentId} AND subject_id = #{subjectId} AND subject_seq = #{subjectSeq}
	</update>
	
	<update id="clickDelete" parameterType="map">
		UPDATE ENROLL 
		SET del_yn = 'Y' 
		WHERE student_id = #{studentId} AND subject_id = #{subjectId} AND subject_seq = #{subjectSeq}
	</update>

</mapper>